<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="Term.css.template" rel="stylesheet" type="text/css" id="ss" />
        <title>Aptana Web Terminal</title>
		<script src="webterm_compressed.js"></script>
        <script>
            var terminal;
			var terminalElementID = "terminal";
			var characterWidth = null, characterHeight = null;
			var RESIZE_INTERVAL = 250;
			var resizeID = null;
            
			/**
			 * init
			 */
            function init()
            {
				var query = getQuery();
				
				var config = {
					id: (query !== null && query.hasOwnProperty("id")) ? query.id : null,
					autoStart: false,
					showTitle: false
				};
				
				// create terminal
                terminal = new Term(terminalElementID, 80,20, config);
				
				// resize to fit
				resizeHelper();
				
				// start processing
				terminal.toggleRunState();
            }
			
			/**
			 * getQuery
			 */
			function getQuery()
			{
				var query = window.location.search.substring(1);
				var keypairs = query.split("&");
				var result = {};
				
				for (var i = 0; i < keypairs.length; i++)
				{
					var parts = keypairs[i].split("=");
					var key = parts[0];
					var value = parts[1];
					
					result[key] = value;
				}
				
				return result;
			}
            
			/**
			 * autoSize
			 */
			function autoSize()
			{
				if (resizeID !== null)
				{
					window.clearTimeout(resizeID);
				}
				
				resizeID = window.setTimeout(resizeHelper, RESIZE_INTERVAL);
			}
			
			/**
			 * resizeHelper
			 */
			function resizeHelper()
			{
				// clear timeout id
				resizeID = null;
				
				if (characterWidth === null || characterHeight === null)
				{
					var div = document.getElementById(terminalElementID);
					var divWidth = div.offsetWidth;
					var divHeight = div.offsetHeight;
					
					characterWidth = divWidth / terminal.getWidth();
					characterHeight = divHeight / terminal.getHeight();
				}
				
				var viewWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
				var viewHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
				var width = Math.floor(viewWidth / characterWidth);
				var height = Math.floor(viewHeight / characterHeight);
				
				terminal.setSize(width,height);
			}
        </script>
    </head>
    <body onload="init();" onresize="autoSize();">
		<div id="terminal"></div>
    </body>
</html>
